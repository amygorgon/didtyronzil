<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Tralcan X">
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>DID.tyron - tyronzil</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "DID.tyron";
    var mkdocs_page_input_path = "smart-contracts/DID.tyron.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> tyronzil</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Welcome</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../W3C-dids/">W3C DIDs terminology</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">DID Method</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">Scheme</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../scheme/did-scheme/">DID Scheme</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../scheme/did-url-syntax/">DID-URL syntax</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../did-document/">DID Document</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">CRUD operations</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../CRUD-operations/did-create/">Create</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../CRUD-operations/did-resolve/">Resolve</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../CRUD-operations/did-recover/">Recover</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../CRUD-operations/did-update/">Update</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../CRUD-operations/did-deactivate/">Deactivate</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../security-privacy/">Security & privacy</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../protocol-parameters/">Parameters</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../implementation/models/">Models</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Smart contracts</span></p>
                <ul class="current">
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">DID.tyron</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#immutable-fields">Immutable fields</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mutable-fields">Mutable fields</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-xwallet-fields">The xWallet fields</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#procedures">Procedures</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-xwallet-procedure">The xWallet procedure</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#transitions">Transitions</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#the-xwallet-transitions">The xWallet transitions</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../INIT.tyron/">INIT.tyron</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Implementation</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="https://github.com/tralcanx/tyronzil">Client</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/pungtas/tyron.js">Library</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="https://github.com/pungtas/tyron-react-native">DID Browser</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../roadmap/">Development</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">tyronzil</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Smart contracts &raquo;</li>
        
      
    
    <li>DID.tyron</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/julio-cabdu/didtyronZIL/edit/master/docs/smart-contracts/DID.tyron.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="didtyron-decentralized-identifier-smart-contract">DID.tyron: Decentralized Identifier smart contract</h1>
<p>A tyronzil Decentralized Identifier gets instantiated from the DID.tyron smart-contract code that is stored on-chain in the <a href="../INIT.tyron/">INIT.tyron</a> smart contract. For that, the user MUST give their Zilliqa address as the <em>contract owner</em>. Once the DID smart contract gets deployed, its code is immutable (the code can never get modified under the same contract's address). However, the DID contract has mutable fields declared in its code, and there are predetermined ways, called transitions, that can modify those fields in specific manners.</p>
<blockquote>
<p>Find the <a href="https://github.com/pungtas/tyron.js/blob/master/lib/blockchain/smart-contracts/zilliqa/did.tyron.scilla">DID.tyron code</a> on GitHub.</p>
</blockquote>
<h2 id="immutable-fields">Immutable fields</h2>
<p>Immutable fields are set at deployment and can not get modified. The DID smart contract gets deployed with the following immutable fields:</p>
<ol>
<li><em>initContractOwner</em>: The Zilliqa address of the user who is the owner of the contract | [ByStr20 type]</li>
<li><em>initTyron</em>: The Zilliqa address of the <a href="../INIT.tyron/">INIT.tyron</a> smart contract | [ByStr20 type]</li>
</ol>
<h2 id="mutable-fields">Mutable fields</h2>
<p>Mutable fields can get modified but only if there is a specific code in the contract that allows it. They MUST get initialized with a value at deployment.</p>
<ol>
<li><em>contract_owner</em>: The Zilliqa address of the user that can get updated by the <em>UpdateOwner</em> transition | [ByStr20 type]</li>
<li><em>decentralized_identifier</em>: The user's DID generated according to the <a href="../../scheme/did-scheme/">DID Scheme</a> - [String type].</li>
<li><em>init_tyron</em>: The address of the <a href="../INIT.tyron/">INIT.tyron</a> contract's latest implementation | [ByStr20 type]</li>
<li><em>resource_records</em>: The Decentralized Identifier's DNS resource records | @key: domain | @value: avatar | [Map String String type]</li>
<li><em>did_agents</em>: The user's SSI agents | @key: avatar.agent | @value: agent's address | [Map String ByStr20 type]</li>
<li><em>latest_agent</em>: The Zilliqa address of the current agent | [ByStr20 type]</li>
<li><em>did_status</em>: The DID Status can be <em>Undefined</em>, <em>Initialized</em>, <em>Created</em>, <em>Updated</em>, <em>Recovered</em> or <em>Deactivated</em> | [DidStatus ADT type]</li>
<li><em>verification_methods</em>: The Tyron verification methods are the public keys used by the DID smart contract | @key: key purpose | @value: public key of type "SchnorrSecP256k1VerificationKey2019" | [Map String ByStr33 type]</li>
<li><em>services</em>: The DID service endpoints | @key: ID | @value: service type &amp; URI | [Map String Pair String String type]</li>
<li><em>tyron_hash</em>: The SHA256 hash of the DID. It is necessary to sign this hash to perform certain operations, such as deactivation of the DID | [ByStr type]</li>
<li><em>did_update_key</em> &amp; <em>did_recovery_key</em>: The public <a href="../../protocol-parameters/#did-keys">DID Keys</a> to enable future operations are stored in the DID contract to execute the <em>IsRightSignature</em> procedure - [ByStr type]</li>
<li><em>created</em>: The block number when the DID Create tyronzil transaction occurred | [BNum type]</li>
<li><em>ledger_time</em>: The block number when the last tyronzil transaction occurred | [BNum type]</li>
<li>
<p><em>transaction_number</em>: A monotonically increasing number representing the amount of tyronzil transactions that have taken place | [Uint128 type]</p>
<p>The following fields get determined by calling the <em>init</em> transition which sends a message to the <a href="../INIT.tyron/">INIT.tyron</a> contract that, in return, call the <em>InitCallBack</em> transition:</p>
</li>
<li>
<p><em>operation_cost</em>: The cost of each tyronzil transaction type, e.g. ".did" for DID operations | [Map String Uint128 type] </p>
</li>
<li><em>foundation_address</em>: The address of the Tyron Pungtas Foundation | [ByStr20 type]</li>
<li><em>agent_comission</em>: The agent's comission as a % of the <em>operation_cost</em> | @key: avatar.agent | @value: comission | [Map String Uint 128 type]</li>
<li><em>latest_comission</em>: It corresponds to the commission of the current agent | [Uint128 type] </li>
</ol>
<h3 id="the-xwallet-fields">The xWallet fields</h3>
<ol>
<li><em>xWallet</em>: The SSI Token implementations | @key: token address | @value: token name | [Map ByStr20 String type]</li>
<li><em>xBalances</em>: The SSI Token balances | @key: token name | @value: balance | [Map String Uint128 type]</li>
<li><em>xProxies</em>: The SSI Token proxies | @key: token name | @value: proxy address | [Map String ByStr20 type]</li>
<li>
<p><em>donation</em>: The Donation Scheme | @key: campaign name | @value: campaign's starting blok number | [Map String BNum]</p>
<blockquote>
<p><a href="https://github.com/pungtas/pung.me">Pung.me</a> is the first DID dapp that the user can use to make donations</p>
</blockquote>
</li>
</ol>
<h2 id="procedures">Procedures</h2>
<p>Procedures can change the state of the contract (mutable fields), but they are not part of the public API which means that they can only get invoked from within the contract itself.</p>
<ol>
<li><em>DidScheme</em>: It generates the user's <em>decentralized_identifier</em> &amp; <em>tyron_hash</em>. This procedure is the only way to generate the Decentralized Identifier, and it can only get executed by the <em>DidCreate</em> transition.</li>
<li><em>ThrowError</em>: The procedure to throw an error.</li>
<li><em>IsRightCaller</em>: Validates that the call comes from an SSI Trinity entity. This procedure matches against the <em>SsiTrinity</em> ADT that can be: <em>user</em> (to validate that the call comes from the user/ contract owner address), <em>agent</em> (to verify the agent in the Payment procedure) or <em>tyron</em> (to validate that the call comes from the <a href="../INIT.tyron/">INIT.tyron</a> contract.</li>
<li><em>IsRightStatus</em>: Verifies that the DID Status is correct for the given operation.</li>
<li><em>Donation</em>: Checks that the donation campaign code is within the limitation period of 1-week.</li>
<li><em>Payment</em>: Executes the payment to the agents and foundation.</li>
<li><em>IsRightSignature</em>: Verifies the Schnorr signature that comes with the signed data corresponds with the public DID Keys stored in the contract.</li>
<li><em>UpdateDocument</em>: Updates the verification methods and services map fields.</li>
<li><em>IsValidKey</em>: Verifies that the new DID Key is unique and not utilized more than once.</li>
<li><em>Timestamp</em>: Generates a timestamp that sets the <em>ledger_time</em> &amp; <em>transaction_number</em>.</li>
</ol>
<h3 id="the-xwallet-procedure">The xWallet procedure</h3>
<ol>
<li><em>XWallet</em>: Verifies the validity, checks &amp; updates the balance of the SSI Tokens</li>
</ol>
<h2 id="transitions">Transitions</h2>
<p>Transitions are the public API and get invoked by sending messages to the contract.  </p>
<ol>
<li><em>UpdateOwner</em>: Updates the Zilliqa address of the user aka contract owner.</li>
<li><em>UpdateInit</em>: Updates the <a href="../INIT.tyron/">INIT.tyron</a> contract to the address of its latest implementation - only the user can execute this transition.</li>
<li><em>Init</em>: Sets the agent's info into the user's DID smart contract &amp; sends a message to the <a href="../INIT.tyron/">INIT.tyron</a> contract that, in return, calls the <em>InitCallBack</em> transition. It also sets the <em>did_status</em> to Initialized.</li>
<li><em>InitCallBack</em>: The <a href="../INIT.tyron/">INIT.tyron</a> contract calls this transition to set the <em>operation_cost</em>, <em>foundation_address</em> &amp; address and commission of the given agent.</li>
<li><em>SetSsiDomain</em>: Sets a domain name for the Decentralized Identifier.</li>
<li><em>SetDomainCallBack</em>: The <a href="../INIT.tyron/">INIT.tyron</a> contract calls this transition to set a user's domain name.</li>
<li><em>DidCreate</em>: Executes a <a href="../../CRUD-operations/did-create/">DID Create</a> tyronzil transaction.</li>
<li><em>DidRecover</em>: Executes a <a href="../../CRUD-operations/did-recover/">DID Recover</a> tyronzil transaction.</li>
<li><em>DidUpdate</em>: Executes a <a href="../../CRUD-operations/did-update/">DID Update</a> tyronzil transaction.</li>
<li><em>DidDeactivate</em>: Executes a <a href="../../CRUD-operations/did-deactivate/">DID Deactivate</a> tyronzil transaction.</li>
</ol>
<h3 id="the-xwallet-transitions">The xWallet transitions</h3>
<ol>
<li><em>SsiToken</em>: To set/update a SSI Token.</li>
<li><em>SsiTokenCallBack</em>: The <a href="../INIT.tyron/">INIT.tyron</a> contract calls this transition to update an SSI Token to its latest implementation (token name, proxy address and token implementation address).</li>
<li><em>ZilIn</em>: Adds native funds (ZIL) to the xWallet.</li>
<li><em>ZilOut</em>: Sends ZIL from the xWallet to any recipient that implements the input tag (e.g. "ZilIn", "").</li>
<li>RecipientAcceptTransfer: The ZRC-2 acceptance transition - MUST be defined or transfers to this xWallet will fail otherwise.</li>
<li><em>XTransfer</em>: Transfers ZRC-2 SSI Tokens.</li>
<li><em>TransferSuccessCallBack</em>: the ZRC-2 callback transition - MUST be defined or transfers from this xWallet will fail otherwise.</li>
<li><em>Donate</em>: To initialize a donation campaign code.</li>
<li><em>DonateCallBack</em>: The <a href="../INIT.tyron/">INIT.tyron</a> contract calls this transition to save the donation campaign code into the DID smart contract.F</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../INIT.tyron/" class="btn btn-neutral float-right" title="INIT.tyron">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../implementation/models/" class="btn btn-neutral" title="Models"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright (C) 2021 Tyron Pungtas</p>
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/julio-cabdu/didtyronZIL/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../implementation/models/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../INIT.tyron/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
